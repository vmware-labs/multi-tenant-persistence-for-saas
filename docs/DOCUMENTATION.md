<!-- Code generated by gomarkdoc. DO NOT EDIT -->

# authorizer

```go
import "github.com/vmware-labs/multi-tenant-persistence-for-saas/pkg/authorizer"
```

## Index

- [Constants](<#constants>)
- [type Authorizer](<#type-authorizer>)
- [type MetadataBasedAuthorizer](<#type-metadatabasedauthorizer>)
  - [func (s MetadataBasedAuthorizer) Configure(_ string, _ map[string]dbrole.DbRole)](<#func-metadatabasedauthorizer-configure>)
  - [func (s MetadataBasedAuthorizer) GetAuthContext(orgId string, roles ...string) context.Context](<#func-metadatabasedauthorizer-getauthcontext>)
  - [func (s MetadataBasedAuthorizer) GetDefaultOrgAdminContext() context.Context](<#func-metadatabasedauthorizer-getdefaultorgadmincontext>)
  - [func (s MetadataBasedAuthorizer) GetMatchingDbRole(ctx context.Context, tableNames ...string) (dbrole.DbRole, error)](<#func-metadatabasedauthorizer-getmatchingdbrole>)
  - [func (s MetadataBasedAuthorizer) GetOrgFromContext(ctx context.Context) (string, error)](<#func-metadatabasedauthorizer-getorgfromcontext>)


## Constants

```go
const (
    GLOBAL_DEFAULT_ORG_ID = "_GlobalDefaultOrg"

    METADATA_KEY_ORGID            = "orgid"
    METADATA_KEY_ROLE             = "role"
    METADATA_ROLE_SERVICE_ADMIN   = "service_admin"
    METADATA_ROLE_SERVICE_AUDITOR = "service_auditor"
    METADATA_ROLE_ADMIN           = "admin"   // can be tenant_admin, *_admin
    METADATA_ROLE_AUDITOR         = "auditor" // can be tenant_auditor, *_auditor
)
```

## type [Authorizer](<https://github.com/vmware-labs/multi-tenant-persistence-for-saas/blob/main/pkg/authorizer/authorizer.go#L30-L36>)

Authorizer Interface defines the methods required for datastore to restrict access based on roles configured in context.

```go
type Authorizer interface {
    Configure(tableName string, roleMapping map[string]dbrole.DbRole)
    GetAuthContext(orgId string, roles ...string) context.Context
    GetDefaultOrgAdminContext() context.Context
    GetOrgFromContext(ctx context.Context) (string, error)
    GetMatchingDbRole(ctx context.Context, tableNames ...string) (dbrole.DbRole, error)
}
```

## type [MetadataBasedAuthorizer](<https://github.com/vmware-labs/multi-tenant-persistence-for-saas/blob/main/pkg/authorizer/metadata_authorizer.go#L41>)

```go
type MetadataBasedAuthorizer struct{}
```

### func \(MetadataBasedAuthorizer\) [Configure](<https://github.com/vmware-labs/multi-tenant-persistence-for-saas/blob/main/pkg/authorizer/metadata_authorizer.go#L79>)

```go
func (s MetadataBasedAuthorizer) Configure(_ string, _ map[string]dbrole.DbRole)
```

### func \(MetadataBasedAuthorizer\) [GetAuthContext](<https://github.com/vmware-labs/multi-tenant-persistence-for-saas/blob/main/pkg/authorizer/metadata_authorizer.go#L83>)

```go
func (s MetadataBasedAuthorizer) GetAuthContext(orgId string, roles ...string) context.Context
```

### func \(MetadataBasedAuthorizer\) [GetDefaultOrgAdminContext](<https://github.com/vmware-labs/multi-tenant-persistence-for-saas/blob/main/pkg/authorizer/metadata_authorizer.go#L87>)

```go
func (s MetadataBasedAuthorizer) GetDefaultOrgAdminContext() context.Context
```

### func \(MetadataBasedAuthorizer\) [GetMatchingDbRole](<https://github.com/vmware-labs/multi-tenant-persistence-for-saas/blob/main/pkg/authorizer/metadata_authorizer.go#L57>)

```go
func (s MetadataBasedAuthorizer) GetMatchingDbRole(ctx context.Context, tableNames ...string) (dbrole.DbRole, error)
```

### func \(MetadataBasedAuthorizer\) [GetOrgFromContext](<https://github.com/vmware-labs/multi-tenant-persistence-for-saas/blob/main/pkg/authorizer/metadata_authorizer.go#L43>)

```go
func (s MetadataBasedAuthorizer) GetOrgFromContext(ctx context.Context) (string, error)
```

# datastore

```go
import "github.com/vmware-labs/multi-tenant-persistence-for-saas/pkg/datastore"
```

## Index

- [Constants](<#constants>)
- [Variables](<#variables>)
- [func GetLogger() *logrus.Entry](<#func-getlogger>)
- [func GetOrgId(record Record) (string, bool)](<#func-getorgid>)
- [func GetRlsPolicyName(username string, tableName string) string](<#func-getrlspolicyname>)
- [func GetTableName(x interface{}) string](<#func-gettablename>)
- [func GetTableNameFromSlice(x interface{}) string](<#func-gettablenamefromslice>)
- [func IsMultitenant(x Record, tableNames ...string) bool](<#func-ismultitenant>)
- [func IsPointerToStruct(x interface{}) (isPtrType bool)](<#func-ispointertostruct>)
- [func IsRevisioningSupported(tableName string, x Record) bool](<#func-isrevisioningsupported>)
- [func Parse(x interface{}) (*schema.Schema, error)](<#func-parse>)
- [func TypeName(x interface{}) (typeName string)](<#func-typename>)
- [type DataStore](<#type-datastore>)
  - [func GetDefaultDataStore(logger *logrus.Entry, authorizer authorizer.Authorizer) (d DataStore, err error)](<#func-getdefaultdatastore>)
- [type DataStoreHelper](<#type-datastorehelper>)
- [type DataStoreTestHelper](<#type-datastoretesthelper>)
- [type Record](<#type-record>)
  - [func GetRecordInstanceFromSlice(x interface{}) Record](<#func-getrecordinstancefromslice>)


## Constants

```go
const (
    // DB Runtime Parameters.
    DB_CONFIG_ORG_ID = "multitenant.orgId" // Name of Postgres run-time config. parameter that will store current user's org. ID

    // Env. variable names.
    DB_NAME_ENV_VAR           = "DB_NAME"
    DB_PORT_ENV_VAR           = "DB_PORT"
    DB_HOST_ENV_VAR           = "DB_HOST"
    SSL_MODE_ENV_VAR          = "SSL_MODE"
    DB_ADMIN_USERNAME_ENV_VAR = "DB_ADMIN_USERNAME"
    DB_ADMIN_PASSWORD_ENV_VAR = "DB_ADMIN_PASSWORD"
)
```

```go
const (
    // Logging configuration variables.
    LOG_LEVEL_ENV_VAR = "LOG_LEVEL"

    // Constants for LOG field names & values.
    COMP             = "comp"
    SAAS_PERSISTENCE = "saas-persistence"
)
```

```go
const (
    // Struct Field Names.
    FIELD_ORGID = "OrgId"

    // SQL Columns.
    COLUMN_ORGID    = "org_id"
    COLUMN_REVISION = "revision"

    // Messages.
    REVISION_OUTDATED_MSG = "Invalid update - outdated "
)
```

## Variables

```go
var LOG = GetLogger()
```

## func [GetLogger](<https://github.com/vmware-labs/multi-tenant-persistence-for-saas/blob/main/pkg/datastore/datastore.go#L81>)

```go
func GetLogger() *logrus.Entry
```

## func [GetOrgId](<https://github.com/vmware-labs/multi-tenant-persistence-for-saas/blob/main/pkg/datastore/sql_struct.go#L376>)

```go
func GetOrgId(record Record) (string, bool)
```

Returns the requested OrgId field's value from record, which is a struct or a pointer to a struct implementing Record interface. Uses a tag rather than field name to find the desired field. Returns an empty string and false if such a field is not present.

## func [GetRlsPolicyName](<https://github.com/vmware-labs/multi-tenant-persistence-for-saas/blob/main/pkg/datastore/sql_struct.go#L242>)

```go
func GetRlsPolicyName(username string, tableName string) string
```

Generates RLS\-policy name based on database role/user and table name.

## func [GetTableName](<https://github.com/vmware-labs/multi-tenant-persistence-for-saas/blob/main/pkg/datastore/sql_struct.go#L214>)

```go
func GetTableName(x interface{}) string
```

Extracts struct's name, which will serve as DB table name, using reflection.

## func [GetTableNameFromSlice](<https://github.com/vmware-labs/multi-tenant-persistence-for-saas/blob/main/pkg/datastore/sql_struct.go#L225>)

```go
func GetTableNameFromSlice(x interface{}) string
```

Extracts name of a struct comprising the input slice.

## func [IsMultitenant](<https://github.com/vmware-labs/multi-tenant-persistence-for-saas/blob/main/pkg/datastore/sql_struct.go#L70>)

```go
func IsMultitenant(x Record, tableNames ...string) bool
```

Checks if any of the tables in tableNames are multi\-tenant.

## func [IsPointerToStruct](<https://github.com/vmware-labs/multi-tenant-persistence-for-saas/blob/main/pkg/datastore/database.go#L223>)

```go
func IsPointerToStruct(x interface{}) (isPtrType bool)
```

## func [IsRevisioningSupported](<https://github.com/vmware-labs/multi-tenant-persistence-for-saas/blob/main/pkg/datastore/sql_struct.go#L57>)

```go
func IsRevisioningSupported(tableName string, x Record) bool
```

Checks if revisioning is supported in the given table \(if the struct contains a field with column name equal to "revision"\).

## func [Parse](<https://github.com/vmware-labs/multi-tenant-persistence-for-saas/blob/main/pkg/datastore/sql_struct.go#L205>)

```go
func Parse(x interface{}) (*schema.Schema, error)
```

## func [TypeName](<https://github.com/vmware-labs/multi-tenant-persistence-for-saas/blob/main/pkg/datastore/database.go#L213>)

```go
func TypeName(x interface{}) (typeName string)
```

## type [DataStore](<https://github.com/vmware-labs/multi-tenant-persistence-for-saas/blob/main/pkg/datastore/datastore.go#L44-L58>)

Datastore: Interface to be implemented by the persistence library.

```go
type DataStore interface {
    GetAuthorizer() authorizer.Authorizer
    GetDBTransaction(ctx context.Context, tableName string, record Record) (tx *gorm.DB, err error)
    Find(ctx context.Context, record Record) error
    FindAll(ctx context.Context, records interface{}) error
    FindWithFilter(ctx context.Context, record Record, records interface{}) error
    Insert(ctx context.Context, record Record) (int64, error)
    Delete(ctx context.Context, record Record) (int64, error)
    Update(ctx context.Context, record Record) (int64, error)
    Upsert(ctx context.Context, record Record) (int64, error)
    RegisterWithDAL(ctx context.Context, roleMapping map[string]dbrole.DbRole, record Record) error
    Reset()
    Helper() DataStoreHelper
    TestHelper() DataStoreTestHelper
}
```

### func [GetDefaultDataStore](<https://github.com/vmware-labs/multi-tenant-persistence-for-saas/blob/main/pkg/datastore/database.go#L88>)

```go
func GetDefaultDataStore(logger *logrus.Entry, authorizer authorizer.Authorizer) (d DataStore, err error)
```

## type [DataStoreHelper](<https://github.com/vmware-labs/multi-tenant-persistence-for-saas/blob/main/pkg/datastore/datastore.go#L60-L70>)

```go
type DataStoreHelper interface {
    GetAuthorizer() authorizer.Authorizer
    RegisterWithDALHelper(ctx context.Context, roleMapping map[string]dbrole.DbRole, tableName string, record Record) error
    FindInTable(ctx context.Context, tableName string, record Record) error
    FindAllInTable(ctx context.Context, tableName string, records interface{}) error
    FindWithFilterInTable(ctx context.Context, tableName string, record Record, records interface{}) error
    InsertInTable(ctx context.Context, tableName string, record Record) (int64, error)
    UpdateInTable(ctx context.Context, tableName string, record Record) (int64, error)
    UpsertInTable(ctx context.Context, tableName string, record Record) (int64, error)
    DeleteInTable(ctx context.Context, tableName string, record Record) (int64, error)
}
```

## type [DataStoreTestHelper](<https://github.com/vmware-labs/multi-tenant-persistence-for-saas/blob/main/pkg/datastore/datastore.go#L72-L79>)

```go
type DataStoreTestHelper interface {
    Initialize() error
    DropTables(records ...Record) error                       // Drop DB tables by records
    Drop(tableNames ...string) error                          // Drops DB tables
    DropCascade(cascade bool, tableNames ...string) error     // Drops DB tables, with an option to drop them in a cascading fashion
    Truncate(tableNames ...string) error                      // Truncates DB tables
    TruncateCascade(cascade bool, tableNames ...string) error // Truncates DB tables, with an option to truncate them in a cascading fashion
}
```

## type [Record](<https://github.com/vmware-labs/multi-tenant-persistence-for-saas/blob/main/pkg/datastore/record.go#L23-L26>)

```go
type Record interface {
}
```

### func [GetRecordInstanceFromSlice](<https://github.com/vmware-labs/multi-tenant-persistence-for-saas/blob/main/pkg/datastore/record.go#L28>)

```go
func GetRecordInstanceFromSlice(x interface{}) Record
```

# dbrole

```go
import "github.com/vmware-labs/multi-tenant-persistence-for-saas/pkg/dbrole"
```

## Index

- [type DbRole](<#type-dbrole>)
  - [func (dbRole DbRole) IsDbRoleTenantScoped() bool](<#func-dbrole-isdbroletenantscoped>)
- [type DbRoleSlice](<#type-dbroleslice>)
  - [func (a DbRoleSlice) Len() int](<#func-dbroleslice-len>)
  - [func (a DbRoleSlice) Less(i, j int) bool](<#func-dbroleslice-less>)
  - [func (a DbRoleSlice) Swap(i, j int)](<#func-dbroleslice-swap>)


## type [DbRole](<https://github.com/vmware-labs/multi-tenant-persistence-for-saas/blob/main/pkg/dbrole/dbrole.go#L24>)

Database roles/users.

```go
type DbRole string
```

```go
const (
    // DB Roles.
    TENANT_READER DbRole = "tenant_reader"
    TENANT_WRITER DbRole = "tenant_writer"
    READER        DbRole = "reader"
    WRITER        DbRole = "writer"
)
```

### func \(DbRole\) [IsDbRoleTenantScoped](<https://github.com/vmware-labs/multi-tenant-persistence-for-saas/blob/main/pkg/dbrole/dbrole.go#L39>)

```go
func (dbRole DbRole) IsDbRoleTenantScoped() bool
```

## type [DbRoleSlice](<https://github.com/vmware-labs/multi-tenant-persistence-for-saas/blob/main/pkg/dbrole/dbrole.go#L34>)

```go
type DbRoleSlice []DbRole // Needed for sorting records
```

### func \(DbRoleSlice\) [Len](<https://github.com/vmware-labs/multi-tenant-persistence-for-saas/blob/main/pkg/dbrole/dbrole.go#L35>)

```go
func (a DbRoleSlice) Len() int
```

### func \(DbRoleSlice\) [Less](<https://github.com/vmware-labs/multi-tenant-persistence-for-saas/blob/main/pkg/dbrole/dbrole.go#L51>)

```go
func (a DbRoleSlice) Less(i, j int) bool
```

Returns true if the first role has fewer permissions than the second role, and true if the two roles are the same or the second role has more permissions. A reader role is always considered to have fewer permissions than a writer role. and a tenant\-specific reader/writer role is always considered to have fewer permissions than a non\-tenant specific reader/writer role, respectively.

TENANT\_READER \< READER \< TENANT\_WRITER \< WRITER.

### func \(DbRoleSlice\) [Swap](<https://github.com/vmware-labs/multi-tenant-persistence-for-saas/blob/main/pkg/dbrole/dbrole.go#L69>)

```go
func (a DbRoleSlice) Swap(i, j int)
```

# errors

```go
import "github.com/vmware-labs/multi-tenant-persistence-for-saas/pkg/errors"
```

## Index

- [Constants](<#constants>)
- [Variables](<#variables>)
- [type DbError](<#type-dberror>)
  - [func (e *DbError) Error() string](<#func-dberror-error>)
  - [func (e *DbError) Is(target error) bool](<#func-dberror-is>)
  - [func (e *DbError) Unwrap() error](<#func-dberror-unwrap>)
  - [func (e *DbError) With(msg string) *DbError](<#func-dberror-with>)
  - [func (e *DbError) WithContext(ctx context.Context) *DbError](<#func-dberror-withcontext>)
  - [func (e *DbError) WithMap(kvMap map[ErrorContextKey]string) *DbError](<#func-dberror-withmap>)
  - [func (e *DbError) WithValue(key ErrorContextKey, value string) *DbError](<#func-dberror-withvalue>)
  - [func (e *DbError) Wrap(err error) *DbError](<#func-dberror-wrap>)
- [type ErrorContextKey](<#type-errorcontextkey>)
  - [func (c ErrorContextKey) String() string](<#func-errorcontextkey-string>)


## Constants

```go
const (
    ENV_VAR           = ErrorContextKey("EnvVar")
    DB_ADMIN_USERNAME = ErrorContextKey("dbAdminUsername")
    DB_HOST           = ErrorContextKey("dbHost")
    DB_NAME           = ErrorContextKey("dbName")
    DB_PORT           = ErrorContextKey("dbPort")
    DB_USERNAME       = ErrorContextKey("dbUsername")
    PORT_NUMBER       = ErrorContextKey("PortNumber")
    SQL_STMT          = ErrorContextKey("SqlStmt")
    SSL_MODE          = ErrorContextKey("sslMode")
    TABLE_NAME        = ErrorContextKey("TableName")
    PRIMARY_KEY       = ErrorContextKey("PrimaryKey")
    TYPE              = ErrorContextKey("Type")
)
```

## Variables

```go
var (
    ErrBaseDb              = &DbError{}
    ErrMissingRoleMapping  = ErrBaseDb.With("Missing role mapping for DB table")
    ErrNotPtrToStructSlice = ErrBaseDb.With("Argument is invalid")
    ErrInvalidPortNumber   = ErrBaseDb.With("Port # is invalid")
    ErrMissingEnvVar       = ErrBaseDb.With("An environment variable is missing or empty")
    ErrMissingOrgId        = ErrBaseDb.With("OrgId is missing in context")
    ErrConnectingToDb      = ErrBaseDb.With("Failed to establish a connection with database")
    ErrExecutingSqlStmt    = ErrBaseDb.With("SQL statement could not be executed")
    ErrRegisteringStruct   = ErrBaseDb.With("Registration of a struct with DAL failed")
    ErrStartingTx          = ErrBaseDb.With("Failed to start a transaction")
    ErrCommittingTx        = ErrBaseDb.With("Failed to commit a transaction")
    ErrRevisionConflict    = ErrBaseDb.With("Blocking update due to outdated revision")
    ErrMarshalling         = ErrBaseDb.With("Cannot marshal proto message to binary")
    ErrUnmarshalling       = ErrBaseDb.With("Cannot unmarshal binary to proto message")
    ErrOperationNotAllowed = ErrBaseDb.With("Not authorized to perform the operation on other tenant's data")
    ErrFetchingMetadata    = ErrBaseDb.With("Error fetching metadata from GRPC context")
    ErrTableDoesNotExist   = ErrBaseDb.With("Table does not exist")
    ErrRecordNotFound      = ErrBaseDb.With("Record not found")
    ErrNotPtrToStruct      = ErrBaseDb.With("PointerToStruct expected, invalid type provided")

    ErrAuthContext       = ErrBaseDb.With("Error extracting authContext from context")
    ErrNoAuthContext     = ErrBaseDb.With("Permission denied because authContext is missing")
    ErrNoUserContext     = ErrBaseDb.With("Permission denied because userInformation is missing")
    ErrUserNotAuthorized = ErrBaseDb.With("User is not authorized to access this API")
)
```

## type [DbError](<https://github.com/vmware-labs/multi-tenant-persistence-for-saas/blob/main/pkg/errors/error_codes.go#L74-L78>)

```go
type DbError struct {
    // contains filtered or unexported fields
}
```

### func \(\*DbError\) [Error](<https://github.com/vmware-labs/multi-tenant-persistence-for-saas/blob/main/pkg/errors/error_codes.go#L80>)

```go
func (e *DbError) Error() string
```

### func \(\*DbError\) [Is](<https://github.com/vmware-labs/multi-tenant-persistence-for-saas/blob/main/pkg/errors/error_codes.go#L91>)

```go
func (e *DbError) Is(target error) bool
```

### func \(\*DbError\) [Unwrap](<https://github.com/vmware-labs/multi-tenant-persistence-for-saas/blob/main/pkg/errors/error_codes.go#L99>)

```go
func (e *DbError) Unwrap() error
```

### func \(\*DbError\) [With](<https://github.com/vmware-labs/multi-tenant-persistence-for-saas/blob/main/pkg/errors/error_codes.go#L111>)

```go
func (e *DbError) With(msg string) *DbError
```

### func \(\*DbError\) [WithContext](<https://github.com/vmware-labs/multi-tenant-persistence-for-saas/blob/main/pkg/errors/error_codes.go#L119>)

```go
func (e *DbError) WithContext(ctx context.Context) *DbError
```

### func \(\*DbError\) [WithMap](<https://github.com/vmware-labs/multi-tenant-persistence-for-saas/blob/main/pkg/errors/error_codes.go#L143>)

```go
func (e *DbError) WithMap(kvMap map[ErrorContextKey]string) *DbError
```

### func \(\*DbError\) [WithValue](<https://github.com/vmware-labs/multi-tenant-persistence-for-saas/blob/main/pkg/errors/error_codes.go#L131>)

```go
func (e *DbError) WithValue(key ErrorContextKey, value string) *DbError
```

### func \(\*DbError\) [Wrap](<https://github.com/vmware-labs/multi-tenant-persistence-for-saas/blob/main/pkg/errors/error_codes.go#L103>)

```go
func (e *DbError) Wrap(err error) *DbError
```

## type [ErrorContextKey](<https://github.com/vmware-labs/multi-tenant-persistence-for-saas/blob/main/pkg/errors/error_codes.go#L28>)

```go
type ErrorContextKey string
```

### func \(ErrorContextKey\) [String](<https://github.com/vmware-labs/multi-tenant-persistence-for-saas/blob/main/pkg/errors/error_codes.go#L127>)

```go
func (c ErrorContextKey) String() string
```

# protostore

```go
import "github.com/vmware-labs/multi-tenant-persistence-for-saas/pkg/protostore"
```

## Index

- [func FromBytes(bytes []byte, message proto.Message) error](<#func-frombytes>)
- [func ToBytes(message proto.Message) ([]byte, error)](<#func-tobytes>)
- [type Metadata](<#type-metadata>)
  - [func MetadataFrom(protoStoreMsg ProtoStoreMsg) Metadata](<#func-metadatafrom>)
- [type ProtoStore](<#type-protostore>)
  - [func GetProtoStore(logger *logrus.Entry, ds datastore.DataStore) ProtoStore](<#func-getprotostore>)
- [type ProtoStoreMsg](<#type-protostoremsg>)
- [type ProtobufDataStore](<#type-protobufdatastore>)
  - [func (p ProtobufDataStore) DeleteById(ctx context.Context, id string, msg proto.Message) (int64, error)](<#func-protobufdatastore-deletebyid>)
  - [func (p ProtobufDataStore) DropTables(msgs ...proto.Message) error](<#func-protobufdatastore-droptables>)
  - [func (p ProtobufDataStore) FindAll(ctx context.Context, msgs interface{}) (metadataMap map[string]Metadata, err error)](<#func-protobufdatastore-findall>)
  - [func (p ProtobufDataStore) FindAllAsMap(ctx context.Context, msgsMap interface{}) (metadataMap map[string]Metadata, err error)](<#func-protobufdatastore-findallasmap>)
  - [func (p ProtobufDataStore) FindById(ctx context.Context, id string, msg proto.Message, metadata *Metadata) error](<#func-protobufdatastore-findbyid>)
  - [func (p ProtobufDataStore) GetAuthorizer() authorizer.Authorizer](<#func-protobufdatastore-getauthorizer>)
  - [func (p ProtobufDataStore) GetMetadata(ctx context.Context, id string, msg proto.Message) (md Metadata, err error)](<#func-protobufdatastore-getmetadata>)
  - [func (p ProtobufDataStore) GetRevision(ctx context.Context, id string, msg proto.Message) (int64, error)](<#func-protobufdatastore-getrevision>)
  - [func (p ProtobufDataStore) Insert(ctx context.Context, id string, msg proto.Message) (rowsAffected int64, md Metadata, err error)](<#func-protobufdatastore-insert>)
  - [func (p ProtobufDataStore) InsertWithMetadata(ctx context.Context, id string, msg proto.Message, metadata Metadata) (rowsAffected int64, md Metadata, err error)](<#func-protobufdatastore-insertwithmetadata>)
  - [func (p ProtobufDataStore) Register(ctx context.Context, roleMapping map[string]dbrole.DbRole, msgs ...proto.Message) error](<#func-protobufdatastore-register>)
  - [func (p ProtobufDataStore) Update(ctx context.Context, id string, msg proto.Message) (rowsAffected int64, md Metadata, err error)](<#func-protobufdatastore-update>)
  - [func (p ProtobufDataStore) UpdateWithMetadata(ctx context.Context, id string, msg proto.Message, metadata Metadata) (rowsAffected int64, md Metadata, err error)](<#func-protobufdatastore-updatewithmetadata>)
  - [func (p ProtobufDataStore) Upsert(ctx context.Context, id string, msg proto.Message) (rowsAffected int64, md Metadata, err error)](<#func-protobufdatastore-upsert>)
  - [func (p ProtobufDataStore) UpsertWithMetadata(ctx context.Context, id string, msg proto.Message, metadata Metadata) (rowsAffected int64, md Metadata, err error)](<#func-protobufdatastore-upsertwithmetadata>)


## func [FromBytes](<https://github.com/vmware-labs/multi-tenant-persistence-for-saas/blob/main/pkg/protostore/protostore.go#L91>)

```go
func FromBytes(bytes []byte, message proto.Message) error
```

## func [ToBytes](<https://github.com/vmware-labs/multi-tenant-persistence-for-saas/blob/main/pkg/protostore/protostore.go#L99>)

```go
func ToBytes(message proto.Message) ([]byte, error)
```

## type [Metadata](<https://github.com/vmware-labs/multi-tenant-persistence-for-saas/blob/main/pkg/protostore/protostore.go#L74-L80>)

```go
type Metadata struct {
    Id        string
    ParentId  string
    Revision  int64
    CreatedAt time.Time
    UpdatedAt time.Time
}
```

### func [MetadataFrom](<https://github.com/vmware-labs/multi-tenant-persistence-for-saas/blob/main/pkg/protostore/protostore.go#L107>)

```go
func MetadataFrom(protoStoreMsg ProtoStoreMsg) Metadata
```

## type [ProtoStore](<https://github.com/vmware-labs/multi-tenant-persistence-for-saas/blob/main/pkg/protostore/protostore.go#L36-L72>)

```go
type ProtoStore interface {
    Register(ctx context.Context, roleMapping map[string]dbrole.DbRole, msgs ...proto.Message) error
    Insert(ctx context.Context, id string, msg proto.Message) (rowsAffected int64, md Metadata, err error)
    Update(ctx context.Context, id string, msg proto.Message) (rowsAffected int64, md Metadata, err error)
    Upsert(ctx context.Context, id string, msg proto.Message) (rowsAffected int64, md Metadata, err error)
    FindById(ctx context.Context, id string, msg proto.Message, metadata *Metadata) error
    FindAll(ctx context.Context, msgs interface{}) (metadataMap map[string]Metadata, err error)
    FindAllAsMap(ctx context.Context, msgsMap interface{}) (metadataMap map[string]Metadata, err error)
    DeleteById(ctx context.Context, id string, msg proto.Message) (rowsAffected int64, err error)

    // Inserts a new Protobuf record in the DB.
    // Returns,
    // rowsAffected - 0 if insertion fails; 1 otherwise
    // md - metadata of the new Protobuf record
    // err - error that occurred during insertion, if any
    InsertWithMetadata(ctx context.Context, id string, msg proto.Message, metadata Metadata) (rowsAffected int64, md Metadata, err error)

    // Updates an existing Protobuf record in the DB.
    // Returns,
    // rowsAffected - 0 if update fails; 1 otherwise
    // md - metadata of the updated Protobuf record
    // err - error that occurred during update, if any
    UpdateWithMetadata(ctx context.Context, id string, msg proto.Message, metadata Metadata) (rowsAffected int64, md Metadata, err error)

    // Upserts a Protobuf record in the DB (if the record exists, it is updated; if it does not, it is inserted).
    // Returns,
    // rowsAffected - 0 if upsert fails; 1 otherwise
    // md - metadata of the upserted Protobuf record
    // err - error that occurred during upsert, if any
    UpsertWithMetadata(ctx context.Context, id string, msg proto.Message, metadata Metadata) (rowsAffected int64, md Metadata, err error)

    GetMetadata(ctx context.Context, id string, msg proto.Message) (md Metadata, err error)
    GetRevision(ctx context.Context, id string, msg proto.Message) (rowsAffected int64, err error)

    GetAuthorizer() authorizer.Authorizer
    DropTables(msgs ...proto.Message) error
}
```

### func [GetProtoStore](<https://github.com/vmware-labs/multi-tenant-persistence-for-saas/blob/main/pkg/protostore/protostore.go#L122>)

```go
func GetProtoStore(logger *logrus.Entry, ds datastore.DataStore) ProtoStore
```

## type [ProtoStoreMsg](<https://github.com/vmware-labs/multi-tenant-persistence-for-saas/blob/main/pkg/protostore/protostore.go#L81-L89>)

```go
type ProtoStoreMsg struct {
    Id        string `gorm:"primaryKey"`
    Msg       []byte
    ParentId  string
    Revision  int64
    OrgId     string `gorm:"primaryKey"`
    CreatedAt time.Time
    UpdatedAt time.Time
}
```

## type [ProtobufDataStore](<https://github.com/vmware-labs/multi-tenant-persistence-for-saas/blob/main/pkg/protostore/protostore.go#L117-L120>)

```go
type ProtobufDataStore struct {
    // contains filtered or unexported fields
}
```

### func \(ProtobufDataStore\) [DeleteById](<https://github.com/vmware-labs/multi-tenant-persistence-for-saas/blob/main/pkg/protostore/protostore.go#L426>)

```go
func (p ProtobufDataStore) DeleteById(ctx context.Context, id string, msg proto.Message) (int64, error)
```

### func \(ProtobufDataStore\) [DropTables](<https://github.com/vmware-labs/multi-tenant-persistence-for-saas/blob/main/pkg/protostore/protostore.go#L439>)

```go
func (p ProtobufDataStore) DropTables(msgs ...proto.Message) error
```

### func \(ProtobufDataStore\) [FindAll](<https://github.com/vmware-labs/multi-tenant-persistence-for-saas/blob/main/pkg/protostore/protostore.go#L377>)

```go
func (p ProtobufDataStore) FindAll(ctx context.Context, msgs interface{}) (metadataMap map[string]Metadata, err error)
```

Finds all messages \(of the same type as the element of msgs\) in Protostore and stores the result in msgs. msgs must be a pointer to a slice of Protobuf structs or a pointer to a slice of pointers to Protobuf structs. It will be modified in\-place. Returns a map of Protobuf messages' IDs to their metadata \(parent ID & revision\).

### func \(ProtobufDataStore\) [FindAllAsMap](<https://github.com/vmware-labs/multi-tenant-persistence-for-saas/blob/main/pkg/protostore/protostore.go#L317>)

```go
func (p ProtobufDataStore) FindAllAsMap(ctx context.Context, msgsMap interface{}) (metadataMap map[string]Metadata, err error)
```

### func \(ProtobufDataStore\) [FindById](<https://github.com/vmware-labs/multi-tenant-persistence-for-saas/blob/main/pkg/protostore/protostore.go#L274>)

```go
func (p ProtobufDataStore) FindById(ctx context.Context, id string, msg proto.Message, metadata *Metadata) error
```

Finds a Protobuf message by ID. If metadata arg. is non\-nil, fills it with the metadata \(parent ID & revision\) of the Protobuf message that was found.

### func \(ProtobufDataStore\) [GetAuthorizer](<https://github.com/vmware-labs/multi-tenant-persistence-for-saas/blob/main/pkg/protostore/protostore.go#L130>)

```go
func (p ProtobufDataStore) GetAuthorizer() authorizer.Authorizer
```

### func \(ProtobufDataStore\) [GetMetadata](<https://github.com/vmware-labs/multi-tenant-persistence-for-saas/blob/main/pkg/protostore/protostore.go#L294>)

```go
func (p ProtobufDataStore) GetMetadata(ctx context.Context, id string, msg proto.Message) (md Metadata, err error)
```

### func \(ProtobufDataStore\) [GetRevision](<https://github.com/vmware-labs/multi-tenant-persistence-for-saas/blob/main/pkg/protostore/protostore.go#L308>)

```go
func (p ProtobufDataStore) GetRevision(ctx context.Context, id string, msg proto.Message) (int64, error)
```

### func \(ProtobufDataStore\) [Insert](<https://github.com/vmware-labs/multi-tenant-persistence-for-saas/blob/main/pkg/protostore/protostore.go#L145>)

```go
func (p ProtobufDataStore) Insert(ctx context.Context, id string, msg proto.Message) (rowsAffected int64, md Metadata, err error)
```

### func \(ProtobufDataStore\) [InsertWithMetadata](<https://github.com/vmware-labs/multi-tenant-persistence-for-saas/blob/main/pkg/protostore/protostore.go#L149>)

```go
func (p ProtobufDataStore) InsertWithMetadata(ctx context.Context, id string, msg proto.Message, metadata Metadata) (rowsAffected int64, md Metadata, err error)
```

### func \(ProtobufDataStore\) [Register](<https://github.com/vmware-labs/multi-tenant-persistence-for-saas/blob/main/pkg/protostore/protostore.go#L134>)

```go
func (p ProtobufDataStore) Register(ctx context.Context, roleMapping map[string]dbrole.DbRole, msgs ...proto.Message) error
```

### func \(ProtobufDataStore\) [Update](<https://github.com/vmware-labs/multi-tenant-persistence-for-saas/blob/main/pkg/protostore/protostore.go#L186>)

```go
func (p ProtobufDataStore) Update(ctx context.Context, id string, msg proto.Message) (rowsAffected int64, md Metadata, err error)
```

Fetches metadata for the record and updates the Protobuf message. NOTE: Avoid using this method in user\-workflows and only in service\-to\-service workflows when the updates are already ordered by some other service/app.

### func \(ProtobufDataStore\) [UpdateWithMetadata](<https://github.com/vmware-labs/multi-tenant-persistence-for-saas/blob/main/pkg/protostore/protostore.go#L194>)

```go
func (p ProtobufDataStore) UpdateWithMetadata(ctx context.Context, id string, msg proto.Message, metadata Metadata) (rowsAffected int64, md Metadata, err error)
```

### func \(ProtobufDataStore\) [Upsert](<https://github.com/vmware-labs/multi-tenant-persistence-for-saas/blob/main/pkg/protostore/protostore.go#L226>)

```go
func (p ProtobufDataStore) Upsert(ctx context.Context, id string, msg proto.Message) (rowsAffected int64, md Metadata, err error)
```

Fetches metadata for the record and upserts the Protobuf message. NOTE: Avoid using this method in user\-workflows and only in service\-to\-service workflows when the updates are already ordered by some other service/app.

### func \(ProtobufDataStore\) [UpsertWithMetadata](<https://github.com/vmware-labs/multi-tenant-persistence-for-saas/blob/main/pkg/protostore/protostore.go#L239-L241>)

```go
func (p ProtobufDataStore) UpsertWithMetadata(ctx context.Context, id string, msg proto.Message, metadata Metadata) (rowsAffected int64, md Metadata, err error)
```



Generated by [gomarkdoc](<https://github.com/princjef/gomarkdoc>)
